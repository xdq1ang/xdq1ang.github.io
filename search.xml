<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>NGAP概述</title>
      <link href="/2023/10/21/NGAP/"/>
      <url>/2023/10/21/NGAP/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="一、NGAP-N2-接口协议概述"><a href="#一、NGAP-N2-接口协议概述" class="headerlink" title="一、NGAP(N2)接口协议概述"></a>一、NGAP(N2)接口协议概述</h1><p>N2的传输层是SCTP，上层用户是5G NAS</p><ul><li><p>MM</p></li><li><p>SM</p></li></ul><p>NGAP具备以下能力：</p><ul><li><p>支持建立、保持和释放PDU会话的NG-RAN侧的能力</p></li><li><p>支持intra-RAT和inter-RAT的切换</p></li><li><p>传递UE和AMF之间的NAS信令</p></li><li><p>用户数据报文的资源预留机制</p></li><li><p>能在协议栈上区分出不同用户，并完成UE相关的信令管理</p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-01.png"></p></li></ul><h1 id="二、NGAP接口流程分类"><a href="#二、NGAP接口流程分类" class="headerlink" title="二、NGAP接口流程分类"></a>二、NGAP接口流程分类</h1><h2 id="按照是否和UE相关分类"><a href="#按照是否和UE相关分类" class="headerlink" title="按照是否和UE相关分类"></a>按照是否和UE相关分类</h2><ul><li><p>与UE相关的流程，重要的有：</p><ul><li><p>PDU绘画管理流程</p></li><li><p>UE上下文管理流程</p></li><li><p>UE移动性管理流程</p></li><li><p>寻呼流程</p></li><li><p>NAS消息传送流程</p></li></ul></li><li><p>与UE无关的流程，重要的有：</p><ul><li>N2 Setup</li></ul><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-02.png"></p></li></ul><h2 id="按照是否需要应答分类"><a href="#按照是否需要应答分类" class="headerlink" title="按照是否需要应答分类"></a>按照是否需要应答分类</h2><ul><li><p>需要应答的流程有：</p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-03.png"></p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-04.png"></p></li><li><p>不需要应答的流程有（大部分是UE无关的流程）：</p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-05.png"></p></li></ul><h1 id="三、常见N2接口流程业务串联"><a href="#三、常见N2接口流程业务串联" class="headerlink" title="三、常见N2接口流程业务串联"></a>三、常见N2接口流程业务串联</h1><h2 id="PDU会话建立流程"><a href="#PDU会话建立流程" class="headerlink" title="PDU会话建立流程"></a>PDU会话建立流程</h2><ol><li><p>Step 1：在UE还没来之前，gNB要和AMF池组中所有AMF建立N2关联</p><p>用到的是NG Setup流程，该流程中gNB会和所有AMF建立SCTP偶联，并获取AMF的权重等参数，用于后续的AMF选择。NG Setup流程包括：</p><ul><li><p>NG Setup Request</p></li><li><p>NG Setup Response</p></li></ul><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-06.png"></p></li><li><p>Step 2：NG建链后即可为UE服务。UE发起注册流程，gNB配合AMF建立UE的上下文（包括允许的NSSAI、GUAMI、UE安全能力、移动性限制列表等参数）。涉及的消息包括：</p><ul><li><p>Initial UE Message</p></li><li><p>UPLINK NAS TRANSPORT</p></li><li><p>DOWNLINK NAS TRANSPORT</p></li><li><p>initial Context Setup Request</p></li><li><p>initial Context Setup Response</p></li></ul><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-07.png"></p></li><li><p>Step 3：UE发起PDU会话建立流程。gNB根据网络侧的要求，为UE分配和这个PDU会话及Qos Flow相关的资源（如DRB）。涉及的流程有：</p><ul><li><p>PDU Session Resource Setup Request</p></li><li><p>PDU Session Resource Setup Response</p></li><li><p>UPLINK NAS TRANSPORT</p></li><li><p>DOWNLINK NAS TRANSPORT</p></li></ul><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-08.png"></p></li><li><p>PDU会话建立后常见的N2流程，如：</p><ul><li><p>移动到其他gNB，触发N2或Xn切换流程；</p></li><li><p>不上网了，释放PDU会话，触发PDU会话资源释放流程；</p></li><li><p>空闲状态下有下行数据到达，触发Paging（寻呼）流程；</p></li><li><p>网络侧决定调整UE的Qos或其他参数，触发PDU会话资源修改</p></li><li><p>其他辅助和管理（OAM）流程。</p></li></ul></li></ol><h1 id="四、附录-N2典型流程举例"><a href="#四、附录-N2典型流程举例" class="headerlink" title="四、附录: N2典型流程举例"></a>四、附录: N2典型流程举例</h1><h2 id="PDU会话管理流程"><a href="#PDU会话管理流程" class="headerlink" title="PDU会话管理流程"></a>PDU会话管理流程</h2><ol><li><p>PDU会话管理流程为某个PDU会话的特定Qos Flow分配Uu和N3口的资源，并且针对该UE建立相应的DRB</p></li><li><p>需要注意，消息是发给AMF，但是因为和PDU会话相关，都是发给SMF处理的</p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-09.png"></p></li><li><p>PDU会话管理流程通常不单独出现，而作为一个大流程的一部分。例如PDU会话资源建立流程，就是PDU会话建立流程的一部分。摘取相关的部分如下：</p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-10.png"></p></li></ol><h2 id="UE上下文管理流程"><a href="#UE上下文管理流程" class="headerlink" title="UE上下文管理流程"></a>UE上下文管理流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-11.png"></p><h2 id="UE移动性管理流程"><a href="#UE移动性管理流程" class="headerlink" title="UE移动性管理流程"></a>UE移动性管理流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-12.png"></p><h2 id="寻呼流程"><a href="#寻呼流程" class="headerlink" title="寻呼流程"></a>寻呼流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-13.png"></p><h2 id="NAS消息传送流程"><a href="#NAS消息传送流程" class="headerlink" title="NAS消息传送流程"></a>NAS消息传送流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-14.png"></p><h2 id="接口管理流程"><a href="#接口管理流程" class="headerlink" title="接口管理流程"></a>接口管理流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-15.png"></p><h2 id="配置传递流程"><a href="#配置传递流程" class="headerlink" title="配置传递流程"></a>配置传递流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-16.png"></p><h2 id="警报消息传送流程"><a href="#警报消息传送流程" class="headerlink" title="警报消息传送流程"></a>警报消息传送流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-17.png"></p><h2 id="NRPPa传送流程"><a href="#NRPPa传送流程" class="headerlink" title="NRPPa传送流程"></a>NRPPa传送流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-18.png"></p><h2 id="Trace（跟踪）流程"><a href="#Trace（跟踪）流程" class="headerlink" title="Trace（跟踪）流程"></a>Trace（跟踪）流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-19.png"></p><h2 id="位置报告流程"><a href="#位置报告流程" class="headerlink" title="位置报告流程"></a>位置报告流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-20.png"></p><h2 id="UE-TNLA绑定流程"><a href="#UE-TNLA绑定流程" class="headerlink" title="UE TNLA绑定流程"></a>UE TNLA绑定流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-21.png"></p><h2 id="UE无线能力管理流程"><a href="#UE无线能力管理流程" class="headerlink" title="UE无线能力管理流程"></a>UE无线能力管理流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-22.png"></p><h2 id="Secondary-RAT数据使用量上报流程"><a href="#Secondary-RAT数据使用量上报流程" class="headerlink" title="Secondary RAT数据使用量上报流程"></a>Secondary RAT数据使用量上报流程</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-23.png"></p><h2 id="NGAP典型消息举例"><a href="#NGAP典型消息举例" class="headerlink" title="NGAP典型消息举例"></a>NGAP典型消息举例</h2><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-24.png"></p><p><img src="/%5Cpost-images%5CNGAP%E6%A6%82%E8%BF%B0%5CNGAP-25.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 5GC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OAI开源核心网部署</title>
      <link href="/2023/10/20/oai-kai-yuan-he-xin-wang-bu-shu/"/>
      <url>/2023/10/20/oai-kai-yuan-he-xin-wang-bu-shu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="OAI概述"><a href="#OAI概述" class="headerlink" title="OAI概述"></a>OAI概述</h1><p>OAI-5G核心网络（CN）项目组的目标是提供具有丰富功能集的符合3GPP标准的5G独立（SA）CN实现。OAI 5G CN以灵活的方式设计和实现，可以轻松适应多样化5G用例的需求。OAI 5G CN组件的所有功能都通过专业测试人员、商业gNB（带有COTS UE）和开源RAN模拟器进行持续测试。<br><img src="/post-images/OAI%E9%83%A8%E7%BD%B2/1697732953367.png"></p><h1 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h1><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull ubuntu:bionic<br><span class="hljs-attribute">docker</span> pull mysql:<span class="hljs-number">8</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></tbody></table></figure><h1 id="二、拉取Docker镜像"><a href="#二、拉取Docker镜像" class="headerlink" title="二、拉取Docker镜像"></a>二、拉取Docker镜像</h1><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-amf:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-nrf:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-spgwu-tiny:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-smf:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-udr:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-udm:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-ausf:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-upf-vpp:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-nssf:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-pcf:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/oai-nef:v1.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">docker</span> pull oaisoftwarealliance/trf-gen-cn5g:latest<br></code></pre></td></tr></tbody></table></figure><h1 id="三、克隆oai-cn5g-fed项目源代码"><a href="#三、克隆oai-cn5g-fed项目源代码" class="headerlink" title="三、克隆oai-cn5g-fed项目源代码"></a>三、克隆oai-cn5g-fed项目源代码</h1><ol><li><p>拉取源代码<br><code>git clone --branch v1.5.0 https://gitlab.eurecom.fr/oai/cn5g/oai-cn5g-fed.git</code></p></li><li><p>同步git子模块<br><code>cd oai-cn5g-fed</code><br><code>./scripts/syncComponents.sh</code></p></li></ol><h1 id="四、创建网桥"><a href="#四、创建网桥" class="headerlink" title="四、创建网桥"></a>四、创建网桥</h1><ol><li>创建<br><code>docker network create --driver=bridge --subnet=192.168.70.128/26 -o          "com.docker.network.bridge.name"="demo-oai" demo-oai-public-net</code></li><li>查看<br><code> ifconfig demo-oai</code><br> <code>docker network ls</code><br>注意：删除网桥：<br><code>docker network rm demo-oai-public-net</code></li></ol><h1 id="五、包转发配置"><a href="#五、包转发配置" class="headerlink" title="五、包转发配置"></a>五、包转发配置</h1><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sudo sysctl net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.conf</span><span class="hljs-selector-class">.all</span>.forwarding=<span class="hljs-number">1</span><br>sudo iptables -P FORWARD ACCEPT<br></code></pre></td></tr></tbody></table></figure><h1 id="七、-模拟基站和终端接入测试"><a href="#七、-模拟基站和终端接入测试" class="headerlink" title="七、 模拟基站和终端接入测试"></a>七、 模拟基站和终端接入测试</h1><ol><li>拉取ueransim容器镜像<br><code>docker pull rohankharade/ueransim</code><br><code>docker image tag rohankharade/ueransim:latest ueransim:latest</code></li><li>5GC部署<br><code>cd oai-cn5g-fed/docker-compose</code><br><code> docker-compose -f docker-compose-basic-vpp-nrf.yaml up -d</code><br>如果报错，请删除现有容器： <figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 网络修剪</span><br>docker network prune<br><span class="hljs-comment"># 查看现有容器</span><br>docker container <span class="hljs-built_in">ls</span> <span class="hljs-literal">-a</span><br><span class="hljs-comment"># 删除所有容器</span><br>docker <span class="hljs-built_in">rm</span> <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-qa</span>) 或者 docker system prune<br></code></pre></td></tr></tbody></table></figure></li><li>启动UERANSIM<br> <code>docker-compose -f docker-compose-ueransim-vpp.yaml up -d</code></li><li>取消部署<br><code>docker-compose -f docker-compose-ueransim-vpp.yaml down</code><br><code>python3 ./core-network.py --type stop-basic-vpp --scenario 1</code></li></ol><h1 id="八、其他常用指令"><a href="#八、其他常用指令" class="headerlink" title="八、其他常用指令"></a>八、其他常用指令</h1><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 停止所有容器</span><br>docker stop <span class="hljs-variable">$</span>(docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span> <span class="hljs-literal">-q</span>)<br><span class="hljs-comment"># 抓包</span><br>tshark <span class="hljs-literal">-i</span> demo<span class="hljs-literal">-oai</span> <span class="hljs-operator">-f</span> <span class="hljs-string">"not arp and not port 53 and not host archive.ubuntu.com and not host security.ubuntu.com"</span> <span class="hljs-literal">-w</span> logs.pcap<br>sudo tcpdump <span class="hljs-literal">-i</span> demo<span class="hljs-literal">-oai</span> <span class="hljs-literal">-w</span> logs.pcap<br></code></pre></td></tr></tbody></table></figure><h1 id="九、OAI网元IP"><a href="#九、OAI网元IP" class="headerlink" title="九、OAI网元IP"></a>九、OAI网元IP</h1><table><thead><tr><th>Container</th><th>Ip-address</th></tr></thead><tbody><tr><td>mysql</td><td>192.168.70.131</td></tr><tr><td>oai-amf</td><td>192.168.70.132</td></tr><tr><td>oai-smf</td><td>192.168.70.133</td></tr><tr><td>oai-nrf</td><td>192.168.70.130</td></tr><tr><td>oai-spgwu</td><td>192.168.70.134</td></tr><tr><td>oai-ext-dn</td><td>192.168.70.135</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> 5GC </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
